<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizStudio - Auto Mode</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 600px;
            text-align: center;
            overflow: hidden; /* バーがはみ出ないように */
            position: relative;
        }
        h1 { margin-top: 0; color: #333; }
        
        /* ボタンのデザイン */
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.98); }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        .choice-btn {
            display: block;
            width: 100%;
            margin: 10px 0;
            background-color: #fff;
            color: #333;
            border: 2px solid #007bff;
        }
        .choice-btn:hover { background-color: #e6f2ff; }

        /* 設定エリア */
        .settings {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group { margin-bottom: 10px; }

        /* タイマーバーのデザイン */
        #timer-container {
            width: 100%;
            height: 8px;
            background-color: #e9ecef;
            position: absolute;
            top: 0;
            left: 0;
            display: none; /* 初期状態は非表示 */
        }
        #timer-bar {
            width: 100%;
            height: 100%;
            background-color: #ff4444;
            /* アニメーション用設定 */
            transition-timing-function: linear; 
        }

        /* 画面切り替え用 */
        .hidden { display: none; }
        
        /* 結果表示 */
        #feedback {
            font-weight: bold;
            font-size: 1.2em;
            margin: 10px 0;
            min-height: 1.5em;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="timer-container">
        <div id="timer-bar"></div>
    </div>

    <div id="start-screen">
        <h1>QuizStudio</h1>
        <p>クイズへようこそ！</p>
        
        <div class="settings">
            <h3>モード設定</h3>
            <div class="input-group">
                <label>
                    <input type="checkbox" id="auto-mode-toggle"> 自動進行モード（タイムショック風）
                </label>
            </div>
            <div class="input-group" id="auto-settings" style="display:none; margin-left: 20px;">
                <label>
                    1問あたりの時間: 
                    <input type="number" id="time-limit-input" value="5" min="1" max="60" style="width: 50px;"> 秒
                </label>
            </div>
        </div>

        <button onclick="startQuiz()">クイズスタート</button>
    </div>

    <div id="quiz-screen" class="hidden">
        <h2 id="question-number">第1問</h2>
        <p id="question-text">ここに問題が表示されます</p>
        <div id="choices-area">
            </div>
        <div id="feedback"></div>
        <button id="next-btn" class="hidden" onclick="nextQuestion()">次の問題へ</button>
    </div>

    <div id="result-screen" class="hidden">
        <h2>結果発表</h2>
        <p>あなたのスコアは...</p>
        <h1 id="score-display">0 / 0</h1>
        <button onclick="location.reload()">もう一度遊ぶ</button>
    </div>
</div>

<script>
    // ==========================================
    // ここに問題データを貼り付けてください
    // ==========================================
    const quizData = [
        {
            question: "日本の首都は？",
            choices: ["大阪", "東京", "京都", "福岡"],
            correct: "東京"
        },
        {
            question: "「GAFA」に含まれない企業は？",
            choices: ["Google", "Amazon", "Facebook", "Microsoft"],
            correct: "Microsoft"
        },
        {
            question: "JavaScriptは主にどこで動く？",
            choices: ["ブラウザ", "電子レンジ", "洗濯機", "エアコン"],
            correct: "ブラウザ"
        }
    ];

    // ==========================================
    // ゲームの状態管理用変数
    // ==========================================
    let currentQuestionIndex = 0;
    let score = 0;
    
    // 自動モード用設定
    let isAutoMode = false;
    let timeLimit = 5;
    let timerId = null; // タイマー停止用ID

    // ==========================================
    // 設定画面の処理
    // ==========================================
    
    // チェックボックスの切り替え監視
    document.getElementById('auto-mode-toggle').addEventListener('change', function(e) {
        // チェックが入ったら秒数設定を表示
        document.getElementById('auto-settings').style.display = e.target.checked ? 'block' : 'none';
    });

    // ==========================================
    // クイズ進行ロジック
    // ==========================================

    function startQuiz() {
        // 設定値の読み込み
        const toggle = document.getElementById('auto-mode-toggle');
        const input = document.getElementById('time-limit-input');
        isAutoMode = toggle.checked;
        timeLimit = parseInt(input.value);

        // 画面切り替え
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');

        // もし自動モードならタイマーバーの枠を表示
        if(isAutoMode) {
            document.getElementById('timer-container').style.display = 'block';
        }

        currentQuestionIndex = 0;
        score = 0;
        showQuestion();
    }

    function showQuestion() {
        // 最終問題を超えていたら結果画面へ
        if (currentQuestionIndex >= quizData.length) {
            showResult();
            return;
        }

        const currentData = quizData[currentQuestionIndex];
        
        // 画面の更新
        document.getElementById('question-number').innerText = `第${currentQuestionIndex + 1}問`;
        document.getElementById('question-text').innerText = currentData.question;
        document.getElementById('feedback').innerText = "";
        document.getElementById('next-btn').classList.add('hidden');

        // 選択肢ボタンの生成
        const choicesArea = document.getElementById('choices-area');
        choicesArea.innerHTML = ""; // クリア
        
        currentData.choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.innerText = choice;
            btn.classList.add('choice-btn');
            btn.onclick = () => checkAnswer(choice);
            choicesArea.appendChild(btn);
        });

        // 自動モードならタイマー始動！
        if (isAutoMode) {
            startTimer();
        }
    }

    // --- タイマー関連処理 ---
    function startTimer() {
        const bar = document.getElementById('timer-bar');
        
        // アニメーションのリセット（一旦幅を100%にしてtransitionを切る）
        bar.style.transition = 'none';
        bar.style.width = '100%';
        
        // 少し待ってからアニメーション開始（こうしないとブラウザが認識しない）
        setTimeout(() => {
            bar.style.transition = `width ${timeLimit}s linear`; // 指定秒数で減らす
            bar.style.width = '0%';
        }, 50);

        // 時間切れの監視
        clearTimeout(timerId);
        timerId = setTimeout(() => {
            handleTimeUp();
        }, timeLimit * 1000);
    }

    function stopTimer() {
        clearTimeout(timerId); // 時間切れ監視を解除
        
        // バーのアニメーションを現在位置で止める
        const bar = document.getElementById('timer-bar');
        const computedStyle = window.getComputedStyle(bar);
        const currentWidth = computedStyle.width;
        bar.style.transition = 'none';
        bar.style.width = currentWidth;
    }

    function handleTimeUp() {
        // 時間切れ処理
        checkAnswer(null); // nullは「無回答」の合図
    }

    // --- 回答チェック処理 ---
    function checkAnswer(selectedChoice) {
        // まずタイマーを止める
        if (isAutoMode) stopTimer();

        // ボタンを無効化（連打防止）
        const btns = document.querySelectorAll('.choice-btn');
        btns.forEach(b => b.disabled = true);

        const currentData = quizData[currentQuestionIndex];
        const feedback = document.getElementById('feedback');

        if (selectedChoice === currentData.correct) {
            feedback.innerText = "正解！";
            feedback.style.color = "red";
            score++;
        } else if (selectedChoice === null) {
            feedback.innerText = "時間切れ...";
            feedback.style.color = "blue";
        } else {
            feedback.innerText = `不正解... 正解は「${currentData.correct}」`;
            feedback.style.color = "blue";
        }

        // 次へ進む処理
        if (isAutoMode) {
            // 自動モード：1.5秒後に勝手に次へ
            setTimeout(nextQuestion, 1500);
        } else {
            // 手動モード：「次へ」ボタンを表示
            document.getElementById('next-btn').classList.remove('hidden');
        }
    }

    function nextQuestion() {
        currentQuestionIndex++;
        showQuestion();
    }

    function showResult() {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('timer-container').style.display = 'none'; // バーを隠す
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('score-display').innerText = `${score} / ${quizData.length}`;
    }
</script>

</body>
</html>

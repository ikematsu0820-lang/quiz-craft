<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Studio</title>
<link rel="stylesheet" href="style.css?v=32">
</head>
<body>

<div id="main-view" class="view">
    <div style="text-align:center; margin-bottom:20px;">
        <img src="logo.png" alt="Quiz Studio" class="app-logo">
    </div>
    <p style="text-align:center; color:#666;" data-text="Version">---</p>
    <div style="display:flex; flex-direction:column; gap:15px; margin-top:30px;">
        <button id="main-host-btn" class="btn-primary" data-text="Main.HostBtn">Host</button>
        <button id="main-player-btn" class="btn-success" data-text="Main.PlayerBtn">Player</button>
    </div>
</div>

<div id="host-login-view" class="view hidden">
    <div style="text-align:center; margin-bottom:20px;">
        <img src="logo.png" alt="Quiz Studio" class="app-logo-small">
    </div>
    <h2 data-text="Login.Title">ID Input</h2>
    <hr>
    <div style="text-align:center;">
        <input type="text" id="show-id-input" placeholder="" 
               style="text-align:center; font-size:1.5em; text-transform:uppercase; margin-bottom:15px;">
        <button id="host-login-submit-btn" class="btn-primary btn-block" data-text="Login.SubmitBtn">Login</button>
        <button class="back-to-main btn-block" style="background:#ccc; color:#333; margin-top:10px;" data-text="Login.BackBtn">Back</button>
    </div>
</div>

<div id="host-dashboard-view" class="view hidden">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0;">Show: <span id="dashboard-show-id" style="color:#e91e63;">---</span></h3>
        <button class="back-to-main" style="font-size:0.8em;" data-text="Dashboard.Logout">Logout</button>
    </div>
    <hr>
    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:20px;">
        <button id="dash-create-btn" class="btn-info" style="height:80px; font-weight:bold; font-size:0.9em;" data-text="Dashboard.BtnCreate">Create</button>
        <button id="dash-config-btn" class="btn-primary" style="height:80px; font-weight:bold; font-size:0.9em; background-color:#2c3e50;" data-text="Dashboard.BtnConfig">Config</button>
        <button id="dash-studio-btn" class="btn-danger" style="height:80px; font-weight:bold; font-size:0.9em;" data-text="Dashboard.BtnStudio">Studio</button>
    </div>
    <h4 style="border-bottom:2px solid #ddd; padding-bottom:5px;" data-text="Dashboard.SetListTitle">Saved Sets</h4>
    <div id="dash-set-list" style="max-height:300px; overflow-y:auto; background:#f9f9f9; padding:10px; border-radius:5px;"></div>
</div>

<div id="creator-view" class="view hidden">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="margin:0;" data-text="Creator.Title">Creator</h2>
        <button id="creator-back-btn" style="background:#999; padding:5px 10px;" data-text="Creator.BackBtn">Back</button>
    </div>
    <hr>
    <div style="margin-bottom:15px;">
        <label style="font-weight:bold;" data-text="Creator.LabelSetName">Set Name</label>
        <input type="text" id="quiz-set-title" class="btn-block" placeholder="" style="margin-bottom:10px;">
    </div>
    <div style="background:#fff0f5; padding:15px; border-radius:8px; border:2px solid #ff69b4;">
        <h3 style="margin-top:0; color:#c71585;" data-text="Creator.HeadingNewQ">New Question</h3>
        <label style="font-size:0.8em; font-weight:bold; color:#666;" data-text="Creator.LabelType">Type</label>
        <select id="creator-q-type" class="btn-block" style="margin-bottom:10px; background:#fff;">
            </select>
        <input type="text" id="question-text" class="btn-block" placeholder="" style="margin-bottom:10px;">
        <div id="creator-form-container" style="margin-bottom:10px;"></div>
        <button id="add-question-btn" class="btn-primary btn-block" style="margin-top:10px;" data-text="Creator.BtnAdd">Add</button>
    </div>
    <div style="margin-top:20px;">
        <h4 data-text="Creator.ListHeading">List</h4>
        <ul id="q-list" style="background:white; padding:10px; border:1px solid #ddd; min-height:50px; list-style:none;"></ul>
        <button id="save-to-cloud-btn" class="btn-success btn-block" style="padding:15px; font-weight:bold; margin-top:15px;" data-text="Creator.BtnSave">Save</button>
    </div>
</div>

<div id="config-view" class="view hidden">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="margin:0;" data-text="Config.Title">Config</h2>
        <button id="config-header-back-btn" style="background:#999; padding:5px 10px; font-size:0.8em;" data-text="Config.BackBtn">Back</button>
    </div>
    <hr>
    
    <div style="background:#f0f8ff; padding:15px; border:2px solid #87ceeb; border-radius:8px; margin-bottom:20px;">
        <h3 style="margin:0 0 10px 0; color:#0055ff; font-size:1.1em; text-align:center;" data-text="Config.HeadingAdd">Add Period</h3>
        <div style="margin-bottom:15px;">
            <label class="config-label" data-text="Config.LabelSet">Set</label>
            <select id="config-set-select" class="btn-block config-select"></select>
        </div>
        <div style="margin-bottom:15px;">
            <label class="config-label" data-text="Config.LabelRule">Rule</label>
            <label style="font-size:0.8em; color:#666;" data-text="Config.LabelElim">Elimination</label>
            <select id="config-elimination-rule" class="btn-block config-select" style="margin-bottom:8px;">
                </select>
            <div id="config-elimination-count-area" class="hidden" style="margin-bottom:8px; padding:8px; background:#fff; border:1px solid #ddd; border-radius:4px;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <span style="font-size:0.8em; font-weight:bold; color:#d00;" data-text="Config.LabelElimCount">Slowest</span>
                    <input type="number" id="config-elimination-count" value="1" min="1" style="width:60px; text-align:center; padding:5px;">
                    <span style="font-size:0.8em;" data-text="Config.LabelElimCountSuffix">out</span>
                </div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                <div>
                    <label style="font-size:0.7em; color:#666;" data-text="Config.LabelTime">Time</label>
                    <select id="config-time-limit" class="config-select">
                        <option value="0">0 (No Limit)</option>
                        <option value="10">10s</option>
                        <option value="20">20s</option>
                        <option value="30">30s</option>
                        <option value="60">60s</option>
                    </select>
                </div>
                <div>
                    <label style="font-size:0.7em; color:#666;" data-text="Config.LabelScore">Score</label>
                    <div style="display:flex; gap:5px;">
                        <select id="config-score-unit" class="config-select" style="flex:1;">
                            <option value="point">Point</option>
                            <option value="currency">Yen</option>
                        </select>
                        <button id="config-custom-score-btn" style="flex:0 0 40px; background:#666; padding:0; font-size:1.2em;">üìù</button>
                    </div>
                </div>
            </div>
            <div style="margin-top:5px;">
                <label style="font-size:0.7em; color:#666;" data-text="Config.LabelLoss">Loss</label>
                <select id="config-loss-point" class="config-select">
                    </select>
            </div>
            <div id="config-custom-points-area" class="hidden" style="margin-top:10px; padding:10px; background:#fff; border:2px solid #aaa; border-radius:5px;">
                <h5 style="margin:0 0 10px 0; border-bottom:1px solid #ddd; padding-bottom:5px;" data-text="Config.HeadingCustomScore">Custom Score</h5>
                <div style="display:flex; justify-content:flex-end; align-items:center; gap:5px; margin-bottom:10px; background:#f9f9f9; padding:5px; font-size:0.8em;">
                    <div><span style="color:#0055ff; font-weight:bold;" data-text="Config.LabelBulkPt">Pt:</span><input type="number" id="config-bulk-point-input" value="1" min="1" style="width:40px; text-align:center;"><button id="config-bulk-point-btn" style="padding:2px 6px;" data-text="Config.BtnReflect">Set</button></div>
                    <div><span style="color:#d00; font-weight:bold;" data-text="Config.LabelBulkLoss">Loss:</span><input type="number" id="config-bulk-loss-input" value="0" min="0" style="width:40px; text-align:center;"><button id="config-bulk-loss-btn" style="padding:2px 6px;" data-text="Config.BtnReflect">Set</button></div>
                </div>
                <div id="config-questions-list" style="font-size:0.9em; max-height:200px; overflow-y:auto;"></div>
            </div>
        </div>
        <button id="config-add-playlist-btn" class="btn-block" style="background:#0055ff; color:white; font-weight:bold; padding:12px; border:none; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2);" data-text="Config.BtnAddList">Add List</button>
    </div>

    <div style="border-top:2px solid #ddd; padding-top:10px; margin-bottom:20px;">
        <h4 style="color:#333; margin:0 0 10px 0;" data-text="Config.HeadingList">Playlist</h4>
        <div id="config-playlist-preview" style="background:#eee; padding:10px; border-radius:5px; min-height:50px;"><p style="text-align:center; color:#999; font-size:0.8em;">„Åæ„Å†ËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p></div>
        
        <div style="margin:10px 0; text-align:right;">
            <label style="font-weight:bold; color:#0055ff; cursor:pointer; background:#e6f0ff; padding:5px 10px; border-radius:4px;">
                <input type="checkbox" id="config-final-ranking-chk" checked> <span data-text="Config.LabelFinalRank">Final Ranking</span>
            </label>
        </div>

        <div style="display:flex; gap:5px; margin-bottom:15px; margin-top:15px;">
            <input type="text" id="config-program-title" placeholder="" style="flex:1;">
            <button id="config-save-program-btn" class="btn-info" style="flex:0 0 80px;" data-text="Config.BtnSaveProg">Save</button>
        </div>
    </div>

    <div style="border-top:2px solid #ddd; padding-top:10px; margin-bottom:20px;">
        <h4 style="color:#333; margin:0 0 10px 0;" data-text="Config.HeadingSavedProg">Saved Programs</h4>
        <div id="config-saved-programs-list" style="max-height:200px; overflow-y:auto; background:#f9f9f9; padding:10px; border-radius:5px;"></div>
    </div>

    <button id="config-go-studio-btn" class="btn-danger btn-block" style="padding:15px; font-weight:bold;" data-text="Config.BtnGoStudio">Go Studio</button>
</div>

<div id="host-control-view" class="view hidden">
    <div style="background:#111; color:white; padding:10px; border-radius:8px; text-align:center; margin-bottom:10px; border:4px solid gold;">
        <div style="font-size:0.8em; color:gold;"><span data-text="Studio.OnAir">ON AIR</span> / <span id="studio-show-id">---</span></div>
        <div id="host-room-id" style="font-size:2em; font-weight:bold; letter-spacing:3px;">---</div>
        <div style="display:flex; justify-content:space-around; margin-top:5px; font-size:0.9em;">
            <div><span data-text="Studio.LabelPlayer">Player</span>: <span id="host-player-count">0</span></div>
            <div><span data-text="Studio.LabelAlive">Alive</span>: <span id="host-alive-count" style="color:#00ff00; font-weight:bold;">0</span></div>
        </div>
    </div>

    <div id="studio-program-loader" style="background:#e6f0ff; padding:10px; border-radius:5px; margin-bottom:15px; border:2px solid #0055ff;">
        <h4 style="margin:0 0 5px 0; color:#0055ff; font-size:1em;" data-text="Studio.HeadingLoad">Load</h4>
        <select id="studio-program-select" style="width:100%; margin-bottom:5px;"></select>
        <button id="studio-load-program-btn" class="btn-primary" style="width:100%; font-size:0.9em; padding:8px;" data-text="Studio.BtnLoad">Set</button>
    </div>

    <div id="host-kanpe-area" class="kanpe-card hidden">
        <div style="background:#333; color:#fff; display:inline-block; padding:2px 8px; font-size:0.8em; border-radius:3px; margin-bottom:5px;" data-text="Studio.LabelKanpe">Kanpe</div>
        <div id="kanpe-question" style="font-weight:bold; font-size:1.1em; margin-bottom:5px;"></div>
        <div id="kanpe-answer" style="color:#d00; font-weight:bold;"></div>
        <div id="kanpe-time-limit" style="font-size:0.8em; color:#666; margin-top:5px;"></div>
        <div id="kanpe-point" style="font-size:0.8em; color:#0055ff; font-weight:bold;"></div>
    </div>
    
    <div id="host-status-area" style="text-align:center; margin-bottom:15px; font-weight:bold; color:#666;" data-text="Studio.StatusReady">Ready...</div>

    <div id="studio-timeline-area">
        <h4 style="color:#333; margin:0 0 10px 0; text-align:center;" data-text="Studio.HeadingList">List</h4>
        <div id="studio-period-timeline" style="display:flex; flex-direction:column; gap:1
